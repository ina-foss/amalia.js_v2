<div class="time-label {{displayState}}" [ngClass]="{'activated' : activated,'pinned' :pinnedSlider}">
    <div class="time-display" (click)="switchDisplayCurrentTime()">
        <span class="time-current"><span *ngIf="inverse">- </span>{{time|tcFormat:'f'}}</span>
        <span class="time-duration"> / {{duration|tcFormat:'f'}} </span>
    </div>
</div>
<div #thumbnailContainer [hidden]="thumbnailHidden" class="thumbnail-container {{displayState}}" [ngClass]="{'pinned' :pinnedSlider}"
     *ngIf="enableThumbnail" [hidden]="thumbnailHidden" [ngStyle]="{'left':thumbnailPosition + 'px'}">
    <div #thumbnail class="thumbnail" [ngStyle]="{'background-image':'url('+thumbnailBlob+')'}"></div>
    <div class="tc-thumbnail">{{tcThumbnail|tcFormat:'f'}}</div>
</div>
<div class="controls-container {{displayState}}" [ngClass]="{'activated' : activated,'pinned' :pinnedSlider}">
    <div class="control-bar" (mouseleave)="enableVolumeSlider=false" *ngIf="elements">
        <div *ngIf="hasComponentWithoutZone('progressBar')"
             class="control progress-bar" (mouseenter)="progressBarMouseEnter($event)"
             (mouseleave)= "progressBarMouseLeave($event)" (mousemove)="progressBarMouseMove($event)">
            <div class="ui-slider">
                <div [style]="{width:(currentTime/duration)*100+'%'}" class="ui-slider-progress"></div>
                <input type="range" step='0.01' class="slider" min="0" [value]="progressBarValue" #progressBar
                       (mousedown)="handleProgressBarMouseDown(progressBar.value)"
                       (mousemove)="handleProgressBarMouseMove(progressBar.value)"
                       (mouseup)="handleProgressBarMouseUp(progressBar.value)">
            </div>
        </div>
        <div *ngFor="let colId of [1,2,3]; index as i; last as isLast;" [ngClass]="{'last':isLast,'mid':i===1} "
             class="column">
            <!-- ngSwitch by controls-->
            <ng-container *ngFor="let c of getControlsByZone(colId); " [ngSwitch]="c.control">
                <!-- play pause mode-->
                <div tooltip="{{c.label}}" [ngClass]="{'show':c.priority==1 ||((c.priority === 2 || c.priority === 3) && displayState ==='l')||(c.priority === 2 && displayState ==='m')}"
                     (click)="controlClicked(c.control)" *ngSwitchCase="'playPause'"
                     class="play-pause control" title="{{c.label}}" [ngStyle]="{'order':c.order ? c.order:'0'}">
                    <svg *ngIf="mediaPlayerElement.getMediaPlayer()?.isPaused()" class="amalia-svg-play-size icon">
                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#play'"></use>
                    </svg>
                    <svg *ngIf="!mediaPlayerElement.getMediaPlayer()?.isPaused()" class="amalia-svg-pause-size icon">
                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#pause'"></use>
                    </svg>
                </div>
                <!--FullScreen Button -->
                <div tooltip="{{c.label}}" [ngClass]="{'show':c.priority==1 ||((c.priority === 2 || c.priority === 3) && displayState ==='l')||(c.priority === 2 && displayState ==='m')}"
                     (click)="controlClicked(c.control)" *ngSwitchCase="'toggleFullScreen'"
                     class="toggleFullScreen control" title="{{c.label}}" [ngStyle]="{'order':c.order ? c.order:'0'}">
                    <svg *ngIf="fullScreenMode === false" class="amalia-svg-fullscreen-size icon">
                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#fullscreen'"></use>
                    </svg>
                    <svg *ngIf="fullScreenMode === true" class="amalia-svg-compress-size icon">
                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#compress'"></use>
                    </svg>
                </div>
                <!--Aspect Ratio-->
                <div tooltip="{{c.label}}" [ngClass]="{'show':c.priority==1 ||((c.priority === 2 || c.priority === 3) && displayState ==='l')||(c.priority === 2 && displayState ==='m')}"
                     *ngSwitchCase="'aspectRatio'" class="aspect-ratio control text" title="{{c.label}}"
                     (click)="changeAspectRatio()" [ngStyle]="{'order':c.order ? c.order:'0'}"
                     (mouseenter)="enableListRatio=true;enableVolumeSlider=false;enableListPositionsSubtitle=false">
                    {{aspectRatio}}
                    <ul class="list-options" [ngClass]="{'on':enableListRatio}"
                        (mouseleave)="enableListRatio=false">
                        <li class="header-list">{{c.label}}</li>
                        <li [ngClass]="{'selected': aspectRatio =='4:3'}" (click)="setVideoAspectRatio('16:9')">
                            <svg class="amalia-svg-checked-size icon">
                                <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#checked'"></use>
                            </svg>
                            4:3 <span *ngIf="defaultRatio =='4:3'">(original)</span>
                        </li>
                        <li [ngClass]="{'selected': aspectRatio =='16:9'}" (click)="setVideoAspectRatio('4:3')">
                            <svg class="amalia-svg-checked-size icon">
                                <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#checked'"></use>
                            </svg>
                            16:9 <span *ngIf="defaultRatio =='16:9'">(original)</span>
                        </li>
                    </ul>

                </div>
                <!--Playback Rate-->
                <div tooltip="{{c.label}}" [ngClass]="{'show':(c.priority==1 ||((c.priority === 2 || c.priority === 3) && displayState ==='l')||(c.priority === 2 && displayState ==='m'))  && currentPlaybackRate !== 1}"
                     *ngSwitchCase="'playbackRate'" class="playback-rate control text" title="{{c.label}}"
                     [ngStyle]="{'order':c.order ? c.order:'0'}">
                    {{currentPlaybackRate}}x
                </div>
                <!--Download-->
                <div tooltip="{{c.label}}" [ngClass]="{'show':c.priority==1 ||((c.priority === 2 || c.priority === 3) && displayState ==='l')||(c.priority === 2 && displayState ==='m')}"
                     *ngSwitchCase="'download'" class="control download" title="{{c.label}}"
                     [ngStyle]="{'order':c.order ? c.order:'0'}">
                    <a target="_blank" (click)="buildUrlWithTc(ctl,c)" #ctl>
                        <svg class="amalia-svg-{{c.icon}}-size icon" *ngIf="c.icon">
                            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#'+c.icon"></use>
                        </svg>
                    </a>
                </div>
                <!--Callback-->
                <div [ngClass]="{'show':c.priority==1 ||((c.priority === 2 || c.priority === 3) && displayState ==='l')||(c.priority === 2 && displayState ==='m')}"
                     *ngSwitchCase="'callback'" class="control callback" title="{{c.label}}" tooltip="{{c.label}}"
                     [ngStyle]="{'order':c.order ? c.order:'0'}" (click)="handleCallback(c)">
                    <svg class="amalia-svg-{{c.icon}}-size icon" *ngIf="c.icon">
                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#'+c.icon"></use>
                    </svg>
                </div>
                <!--Volume-->
                <div tooltip="{{c.label}}" [ngClass]="{'show':c.priority==1 ||((c.priority === 2 || c.priority === 3) && displayState ==='l')||(c.priority === 2 && displayState ==='m')}"
                     *ngSwitchCase="'volume'" class="volume control" title="{{c.label}}"
                     [ngStyle]="{'order':c.order ? c.order:'0'}"
                     (mouseenter)="enableVolumeSlider=true;enableListPositionsSubtitle=false;enableListRatio=false"
                     (click)="setupAudioNodes(c.data)">
                    <svg *ngIf="volumeLeft > 0 || volumeRight > 0"
                         class="amalia-svg-volume-on-size icon" (click)="mute();changeVolume(0)">
                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#volume-on'"></use>
                    </svg>
                    <svg *ngIf="volumeLeft == 0 && volumeRight == 0"
                         class="amalia-svg-volume-off-size icon" (click)="unmute();changeVolume(100)">
                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#volume-off'"></use>
                    </svg>
                    <div class="volume-control" [ngClass]="{'on':enableVolumeSlider}"
                         (mouseleave)="enableVolumeSlider=false">
                        <div class="channel-volume-sliders ">
                            <div class="header-list">Volume (m)</div>
                            <div class="channel-volume-control">
                                <div class="channel-volume-control-left">
                                    <div (click)="changeVolume( volumeLeft==0 ? 100:0,'l')" class="channel-volume-icon">
                                        <svg *ngIf="volumeLeft > 0"
                                             class="amalia-svg-volume-on-size icon">
                                            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#volume-on'"></use>
                                        </svg>
                                        <svg *ngIf="volumeLeft== 0"
                                             class="amalia-svg-volume-off-size icon">
                                            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#volume-off'"></use>
                                        </svg>
                                    </div>
                                    <div class="left-volume-slider ui-slider">
                                        <div [style]="{width:volumeLeft+'%'}" class="ui-slider-progress"></div>
                                        <input #leftVolumeSlider (input)="changeVolume(leftVolumeSlider.value,'l')"
                                               [(ngModel)]="volumeLeft" class="slider" max="100"
                                               min="0" type="range"
                                               value="50">
                                    </div>
                                    <div class="channel-volume-info"><span class="text-volume">G</span></div>
                                </div>
                                <div class="channel-volume-control-mid-container">
                                    <div [style]="{left:volumeLeft+'%'}"
                                         *ngIf="mediaPlayerElement?.getMediaPlayer().withMergeVolume"
                                         class="channel-volume-control-mid on">

                                    </div>
                                </div>
                                <div class="channel-volume-control-right">
                                    <div (click)="changeVolume( volumeRight==0 ? 100:0,'r')"
                                         class="channel-volume-icon">
                                        <svg *ngIf="volumeRight > 0"
                                             class="amalia-svg-volume-on-size icon">
                                            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#volume-on'"></use>
                                        </svg>
                                        <svg *ngIf="volumeRight== 0"
                                             class="amalia-svg-volume-off-size icon">
                                            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#volume-off'"></use>
                                        </svg>
                                    </div>
                                    <div class="right-volume-slider ui-slider ">
                                        <div [style]="{width:volumeRight+'%'}" class="ui-slider-progress"></div>
                                        <input #rightVolumeSlider (input)="changeVolume(rightVolumeSlider.value,'r')"
                                               [(ngModel)]="volumeRight" class="slider" max="100"
                                               min="0" type="range"
                                               value="50">
                                    </div>
                                    <div class="channel-volume-info"><span class="text-volume">D</span></div>
                                </div>
                                <div (click)="changeSameVolumeState()" class="channel-volume-info-mid">
                                    <svg *ngIf="!mediaPlayerElement?.getMediaPlayer().withMergeVolume"
                                         class="amalia-svg-padlock-open-size icon">
                                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#padlock-open'"></use>
                                    </svg>
                                    <svg *ngIf="mediaPlayerElement?.getMediaPlayer().withMergeVolume"
                                         class="amalia-svg-padlock-close-size icon">
                                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#padlock-close'"></use>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Button subtitles -->
                <div tooltip="{{c.label}}" [ngClass]="{'show':c.priority==1 ||((c.priority === 2 || c.priority === 3) && displayState ==='l')||(c.priority === 2 && displayState ==='m')}"
                     *ngSwitchCase="'subtitles'" class="control subtitle" title="{{c.label}}"
                     [ngStyle]="{'order':c.order ? c.order:'0'}"
                     (mouseenter)="enableListPositionsSubtitle=true;enableVolumeSlider=false;enableListRatio=false"
                        (click)="updateSubtitlePosition()">
                    <svg class="amalia-svg-subtitle-size icon">
                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#subtitle'"></use>
                    </svg>
                    <ul class="list-options" [ngClass]="{'on':enableListPositionsSubtitle}"
                        (mouseleave)="enableListPositionsSubtitle=false">
                        <li class="header-list">{{c.label}}</li>
                        <li *ngFor="let pos of listOfSubtitles" class="position"
                        [ngClass]="{'selected': position == pos.key}"
                        (click)="updateSubtitlePosition(pos.key)">
                            <svg class="amalia-svg-checked-size icon">
                                <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#checked'"></use>
                            </svg>
                            {{pos.position}}</li>
                    </ul>
                </div>
                <!--Menu Button-->
                <div  tooltip="{{c.label}}" [ngClass]="{'show':(displayState ==='m' || displayState === 'sm') && controls.length > 0}" *ngSwitchCase="'menu'" class="control menu"
                     title="{{c.label}}"
                     (mouseenter)="enableMenu=true;enableVolumeSlider=false"
                     [ngStyle]="{'order':c.order ? c.order:'0'}">
                    <svg class="amalia-svg-dots-size icon">
                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#dots'"></use>
                    </svg>
                </div>
                <!--Other controls-->
                <div tooltip="{{c.label}}" [ngClass]="{'show':c.priority==1 ||((c.priority === 2 || c.priority === 3) && displayState ==='l')||(c.priority === 2 && displayState ==='m')}" class="control"
                     title="{{c.label}}" (click)="controlClicked(c.control)" *ngSwitchDefault
                     [ngStyle]="{'order':c.order ? c.order:'0'}">
                    <svg class="amalia-svg-{{c.icon}}-size icon" *ngIf="c.icon">
                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#'+c.icon"></use>
                    </svg>
                </div>
            </ng-container>
        </div>
    </div>
    <!-- Slider -->
    <div class="playback-rate-slider {{displayState}} "
         [ngClass]="{'activated' : (selectedSlider === 'slider1' && enablePlaybackSlider) || (selectedSlider === 'slider1' && enablePinnedSlider)}"
         *ngIf="elements && hasComponentWithoutZone('playbackRateSteps')">
        <div class="playback-rate-labels">
            <input type="range" list="playback-rate-list" #playbackRateCursor
                   [min]="minPlaybackRateSlider"
                   [max]="maxPlaybackRateSlider"
                   [step]="stepPlaybackRateSlider"
                   [value]="currentPlaybackRate"
                   (change)="onChangePlaybackRate(playbackRateCursor.value)">
            <datalist id="playback-rate-list">
                <option class="label"
                        *ngFor="let pr of sliderListOfPlaybackRateStep;index as i; first:as isFirst; last as isLast;"
                        [ngStyle]="{width:this.sliderListOfPlaybackRateStepWidth[i]+'%' }"
                        [ngClass]="{'first':isFirst,'last':isLast,'selected':pr ==currentPlaybackRate}"
                        (click)="onChangePlaybackRate(pr)" [selected]="pr ==currentPlaybackRate">{{pr}}x
                </option>
            </datalist>
        </div>
    </div>
    <!-- Slider 2-->
    <div class="playback-rate-slider2 {{displayState}}"
         [ngClass]="{'activated' : (selectedSlider === 'slider2' && enablePlaybackSlider) || (selectedSlider === 'slider2' && enablePinnedSlider)}"
         *ngIf="elements && hasComponentWithoutZone('playbackRateCustomSteps')">
        <div *ngFor="let pr of sliderListOfPlaybackRateCustomSteps;index as i; first as isFirst; last as isLast;"
             [ngClass]="{'first':isFirst,'last':isLast,'selected':pr ==currentPlaybackRate}"
             (click)="onChangePlaybackRate(pr)"
              >{{pr}}x
            <div class="line"></div>
        </div>
    </div>
    <div class="menu-slider" [ngClass]="{'activated' : enablePlaybackSlider || enablePinnedSlider}" (mouseenter)="enableMenuSlider = true">
        <svg class="amalia-svg-switch-size icon">
            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#switch'"></use>
        </svg>
        <div class="menu" [ngClass]="{'on' : enableMenuSlider}"
            (mouseleave)="enableMenuSlider = false">
             <div [ngClass]="{'selected' : selectedSlider === 'slider1'}"
                  (click)="changeSlider()">Mode lecture 01</div>
             <div [ngClass]="{'selected' : selectedSlider === 'slider2'}"
                 (click)="changeSlider()">Mode lecture 02</div>
        </div>
    </div>

</div>
<!-- Menu of controls displayed on "m" grid-->
<div class="controls-menu {{displayState}}" [ngClass]="{'on' : enableMenu,'pinned' :pinnedSlider}"
     (mouseenter)="activated= true"
     (mouseleave)="enableMenu=false">
    <ul>
        <ng-container *ngFor="let c of controls; " [ngSwitch]="c.control">
            <!--FullScreen Button -->
            <li (click)="controlClicked(c.control)" *ngSwitchCase="'toggleFullScreen'"
                class="toggleFullScreen control" [ngStyle]="{'order':c.order ? c.order:'0'}">
                <svg class="amalia-svg-{{c.icon}}-size icon" *ngIf="c.icon">
                    <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#'+c.icon"></use>
                </svg>
                {{c.label}}
            </li>
            <!--Aspect Ratio-->
            <li *ngSwitchCase="'aspectRatio'" class="aspect-ratio control text"
                (click)="enableListRatio= !enableListRatio" [ngStyle]="{'order':c.order ? c.order:'0'}">
                <div class="ratio">{{aspectRatio}}</div>
                {{c.label}} <span>{{aspectRatio}}</span>
                <svg class="amalia-svg-right-size icon">
                    <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#right'"></use>
                </svg>
                <ul class="list-options" [ngClass]="{'on':enableListRatio}">
                    <li [ngClass]="{'selected': aspectRatio =='4:3'}" (click)="setVideoAspectRatio('16:9')">
                        <svg class="amalia-svg-checked-size icon">
                            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#checked'"></use>
                        </svg>
                        4:3 <span *ngIf="defaultRatio =='4:3'">(original)</span>
                    </li>
                    <li [ngClass]="{'selected': aspectRatio =='16:9'}" (click)="setVideoAspectRatio('4:3')">
                        <svg class="amalia-svg-checked-size icon">
                            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#checked'"></use>
                        </svg>
                        16:9 <span *ngIf="defaultRatio =='16:9'">(original)</span>
                    </li>
                </ul>
            </li>
            <!--Download-->
            <li *ngSwitchCase="'download'" class="control download" [ngStyle]="{'order':c.order ? c.order:'0'}">
                <a target="_blank" (click)="buildUrlWithTc(ctl,c)" #ctl>
                    <svg class="amalia-svg-{{c.icon}}-size icon" *ngIf="c.icon">
                        <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#'+c.icon"></use>
                    </svg>
                    {{c.label}}
                </a>
            </li>
            <!--Callback-->
            <li *ngSwitchCase="'callback'" class="control callback" [ngStyle]="{'order':c.order ? c.order:'0'}"
                (click)="handleCallback(c)">
                <svg class="amalia-svg-{{c.icon}}-size icon" *ngIf="c.icon">
                    <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#'+c.icon"></use>
                </svg>
                {{c.label}}
            </li>
            <!-- Button subtitles -->
            <li (click)="enableListPositionsSubtitle= !enableListPositionsSubtitle" *ngSwitchCase="'subtitles'"
                class="control subtitle" [ngStyle]="{'order':c.order ? c.order:'0'}">
                <svg class="amalia-svg-{{c.icon}}-size icon" *ngIf="c.icon">
                    <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#'+c.icon"></use>
                </svg>
                {{c.label}}<span>{{position}}</span>
                <svg class="amalia-svg-right-size icon">
                    <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#right'"></use>
                </svg>
                <ul class="list-options" [ngClass]="{'on':enableListPositionsSubtitle}">
                    <li class="position" [ngClass]="{'selected': position =='down'}"
                        (click)="updateSubtitlePosition('down')">
                        <svg class="amalia-svg-checked-size icon">
                            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#checked'"></use>
                        </svg>
                        Bas
                    </li>
                    <li class="position" [ngClass]="{'selected': position =='up'}"
                        (click)="updateSubtitlePosition('up')">
                        <svg class="amalia-svg-checked-size icon">
                            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#checked'"></use>
                        </svg>
                        Haut
                    </li>
                    <li class="position" [ngClass]="{'selected': position =='none'}"
                        (click)="updateSubtitlePosition('none')">
                        <svg class="amalia-svg-checked-size icon">
                            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#checked'"></use>
                        </svg>
                        Aucun (original)
                    </li>
                </ul>
            </li>
            <!--Other controls-->
            <li class="control" (click)="controlClicked(c.control)" *ngSwitchDefault
                [ngStyle]="{'order':c.order ? c.order:'0'}">
                <svg class="amalia-svg-{{c.icon}}-size icon" *ngIf="c.icon">
                    <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#'+c.icon"></use>
                </svg>
                {{c.label}}
            </li>
        </ng-container>
    </ul>
</div>
<!-- Menu of controls displayed on "s" grid-->
<div class="controls-reduced-container {{displayState}}" [ngClass]="{'activated' : activated}">
    <!-- play pause mode-->
    <div (click)="controlClicked('playPause')" class="play-pause control">
        <svg *ngIf="mediaPlayerElement.getMediaPlayer()?.isPaused()" class="amalia-svg-blue-play-size icon">
            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#blue-play'"></use>
        </svg>
        <svg *ngIf="!mediaPlayerElement.getMediaPlayer()?.isPaused()" class="amalia-svg-blue-pause-size icon">
            <use [attr.xlink:href]="'assets/svgs/symbol/svg/sprite.symbol.svg#blue-pause'"></use>
        </svg>
    </div>
</div>
