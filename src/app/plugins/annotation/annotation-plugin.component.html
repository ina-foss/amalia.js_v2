<div class="annotation-content">
    <div class="header">
        <div>
            <p-button class="highlight" label="Ajouter un segment" icon="pi pi-plus" (click)="initializeNewSegment()"
                size="small" [disabled]="dataLoading"></p-button>
            <ng-container *ngIf="segmentsInfo.subLocalisations.length !== 0">
                <p-button class="no-highlight" label="Début" (click)="setTcIn()" icon="pi pi-clock"
                    size="small"></p-button>
                <p-button class="no-highlight" label="Fin" (click)="setTcOut()" icon="pi pi-clock"
                    size="small"></p-button>
            </ng-container>
        </div>
        <div *ngIf="segmentsInfo.subLocalisations.length !== 0">
            <p-button class="no-highlight no-outline" icon="pi pi-download" size="small" (click)="toggleExportMenu()">
            </p-button>
            <div *ngIf="enabledExportButtons" class="export-menu">
                <div class="export-menu-item" (click)="downloadSegmentJsonFormat();toggleExportMenu()"
                    style="cursor:pointer">Exporter au format
                    JSON
                </div>
                <div class="export-menu-item" (click)="downloadSegments();toggleExportMenu()" style="cursor:pointer">
                    Exporter au format Excel
                </div>
            </div>

        </div>
    </div>
    <div *ngIf="segmentsInfo.subLocalisations.length === 0" class="annotation-empty-text">Veuillez cliquer
        sur “Ajouter un segment” pour
        débuter la segmentation du média.
    </div>
    <amalia-toast #toast position="bottom-center" key="br" />
    <div class="card flex justify-content-center">
        <p-confirmDialog #cd>
            <ng-template pTemplate="headless" let-message>
                <div class="flex flex-column align-items-left p-2 surface-overlay border-round">
                    <div class="flex flex-row lg:align-content-around"><span class="font-bold text-2xl block">{{
                            message.header }}</span>
                        <div class="flex justify-content-end w-full">
                            <button type="button" class="p-dialog-titlebar-icon p-link" (click)="cd.reject()">
                                <i class="pi pi-times"></i>
                            </button>
                        </div>
                    </div>
                    <p class="mb-0" style="white-space:pre-wrap; word-wrap:break-word">{{ message.message }}</p>
                    <div class="flex flex-row justify-content-end gap-2 mt-4">
                        <p-button [label]="message.rejectLabel" (click)="cd.reject()"
                            class="p-button-outlined no-highlight" size="small">
                        </p-button>
                        <p-button [label]="message.acceptLabel" (click)="cd.accept()" class="highlight" size="small">
                        </p-button>
                    </div>
                </div>
            </ng-template>
        </p-confirmDialog>
    </div>
    <div class="segments scrollable-content" #annotationElement>
        <div *ngIf="!noSpinner && dataLoading" class="card flex justify-content-center spinner-background">
            <p-progressSpinner ariaLabel="loading" />
        </div>
        <ng-container>
            <div class="segment" *ngFor="let segment of segmentsInfo.subLocalisations; let i = index">
                <amalia-segment [segment]="segment" [tcIn]="segment.tcIn" [tcOut]="segment.tcOut"
                    [displayMode]="segment.data.displayMode" [tcDisplayFormat]="'f'" [fps]="fps"
                    (click)="selectSegment(segment)" [availableCategories]="availableCategories"
                    [availableKeywords]="availableKeywords" [mediaPlayerElement]="mediaPlayerElement"
                    id="{{technical_id+i}}" />
            </div>
        </ng-container>

        <div class="segment-empty"></div>
    </div>
</div>